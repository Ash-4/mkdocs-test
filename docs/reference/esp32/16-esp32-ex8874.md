# ESP32 - EX8874

## WiFi reliability

![WeMos R1 D32 IOREF](/_static/images/esp32/wemos-ioref-label.png){: style="width: 20%" align=right}

- Solder a 250 to 330 ohms resistor, GPIO_0 to 3.3V, for reliable WiFi when using the WeMos D1 R32 ESP32duino.

&nbsp; &nbsp; &nbsp; &nbsp; ![WeMos R1 D32 resistor](/_static/images/esp32/resistor-io0.png){: style="width: 40%" }

## IOREF voltage

- Do not confuse adding the resistor to correct high voltage on GPIO_0 with the need to work around the incorrect voltage of the IOREF pin.

- From top to bottom the pins are: IO0, 5V (incorrect -- so not Arduino UNO R3 compliant), RESET, 3.3V, 5V, GND, GND, VIN as seen here:  

![EX8874 IOREF](/_static/images/esp32/ioref-override.png){: style="width: 25%" align=right}

- Note that some boards may not have the IOREF pin location labelled.  Measure the voltage if in doubt.

- As the IOREF pin on the WeMos D1 R32 is 5V, modify the EX8874 using the 3.3V override solder pad on the EX8874.  &nbsp;If this is not done, the ADC inputs will receive up to 5V when the IOREF pin is 5V.

- Bend the IOREF pin or confirm that the trace connecting the pin is completely cut.

## One EX8874

Review of **motor shield define** from MotorDrivers.h for ESP32 WeMos R1 D32

```cpp
  #elif defined(ARDUINO_ARCH_ESP32)  
  // STANDARD shield on an ESPDUINO-32 (ESP32 in Uno form factor). The shield must be eiter the  
  // 3.3V compatible R3 version or it has to be modified to not supply more than 3.3V to the  
  // analog inputs. Here we use analog inputs A2 and A3 as A0 and A1 are wired in a way so that  
  // they are not useable at the same time as WiFi (what a bummer). The numbers below are the  
  // actual GPIO numbers. In comments the numbers the pins have on an Uno.  
  #define STANDARD_MOTOR_SHIELD F("STANDARD_MOTOR_SHIELD"), \  
    new MotorDriver(25/* 3*/, 19/*12*/, UNUSED_PIN, 13/*9*/, 35/*A2*/, 0.70, 1500, UNUSED_PIN), \  
    new MotorDriver(23/*11*/, 18/*13*/, UNUSED_PIN, 12/*8*/, 34/*A3*/, 0.70, 1500, UNUSED_PIN)  

  // EX 8874 based shield connected to a 3.3V system (like ESP32) and 12bit (4096) ADC  
  // numbers are GPIO numbers. comments are UNO form factor shield pin numbers  
  #define EX8874_SHIELD F("EX8874"),\  
    new MotorDriver(25/* 3*/, 19/*12*/, UNUSED_PIN, 13/*9*/, 35/*A2*/, 1.27, 5000, 36 /*A4*/), \  
    new MotorDriver(23/*11*/, 18/*13*/, UNUSED_PIN, 12/*8*/, 34/*A3*/, 1.27, 5000, 39 /*A5*/)  
```

- STANDARD_MOTOR_SHIELD and EX8874_SHIELD are pre-defined for use with ESP32 in MotorDrivers.h  

- Do not edit MotorDrivers.h; a custom motor define would be added in config.h  

- Note how the ESP32 GPIO pin numbers are used, and the Arduino pin locations are shown/commented.

Alternate pins A2 and A3 are required for the WeMos D1 R32 / ESP32duino.  
One EX8874 motor shield would use the motor define EX8874_SHIELD, and update the solder pads to use A2 and A3.

&nbsp; &nbsp; &nbsp; &nbsp; ![EX8874 WeMos R1 D32 pins](/_static/images/esp32/esp32duino-ex8874-x1.png){: style="width: 70%"}

When one EX8874 motor shield is used with WeMos R1 D32 ESP32duino, the alternate current sense pins are used as the A0 and A1 pin locations cannot be used as ADC input when WiFi is enabled.

&nbsp; &nbsp; &nbsp; &nbsp; ![EX8874 WeMos R1 D32 table](/_static/images/esp32/esp32duino-ex8874-x1b.png){: style="width: 80%"}

==TODO==
